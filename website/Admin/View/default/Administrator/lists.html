<table class="table table-hover">
    <tr>
        <th>用户名</th>
        <th>中文名字</th>
        <th>手机号码</th>
        <th>邮箱</th>
        <th>注册IP</th>
        <th>注册时间</th>
        <th>上次登录IP</th>
        <th>上次登录时间</th>
        <th>登录次数</th>
    </tr>
    <?php foreach($lists as $v):?>
    <tr>
        <td><?php echo $v['username']?></td>
        <td><?php echo $v['truename']?></td>
        <td><?php echo $v['mobile']?></td>
        <td><?php echo $v['email']?></td>
        <td><?php echo $v['regip']?></td>
        <td><?php echo date('Y/m/d H:i',$v['regtime'])?></td>
        <td><?php echo $v['nowip']?></td>
        <td><?php echo date('Y/m/d H:i',$v['nowtime'])?></td>
        <td><?php echo $v['loginnums']?></td>
        <td>

            <?php if($v['userid'] != 1):?>
            <?php if($this->AUTH->check('Admin/Administrator/authorization',session('uid'))):?>
                <a href="<?php echo U('Administrator/authorization',['iiii'=>$v['auid']])?>" class="btn btn-info btn-xs">授权</a>
            <?php endif;?>
            <?php if($this->AUTH->check('Admin/Administrator/update',session('uid'))):?>
                <a href="<?php echo U('Administrator/update',['iiii'=>$v['auid']])?>" class="btn btn-primary btn-xs">修改</a>
            <?php endif;?>
                <?php if($this->AUTH->check('Admin/Ajax/administratorDelete',session('uid'))):?>
                    <a href="javascript:;" data-iiii="<?php echo $v['auid']?>" class="btn btn-danger btn-xs delete">删除</a>
                <?php endif;?>
                <?php if($this->AUTH->check('Admin/Ajax/administratorStatus',session('uid'))):?>
                    <?php if($v['status']):?>
                        <a href="javascript:;" data-iii="0" data-iiii="<?php echo $v['auid']?>" class="btn btn-warning btn-xs status">禁用</a>
                    <?php else:?>
                        <a href="javascript:;" data-iii="1" data-iiii="<?php echo $v['auid']?>" class="btn btn-success btn-xs status">解禁</a>
                    <?php endif;?>
                <?php endif?>
            <?php endif;?>
        </td>
    </tr>
    <?php endforeach;?>
</table>
<script>
    $(function(){
        <?php if($this->AUTH->check('Admin/Ajax/administratorDelete',session('uid'))):?>
        //删除
        $('.delete').unbind('click');
        $('.delete').click(function(){
            var data = {};
            var _this = $(this);
            layer.msg('确定删除吗?<br />删除之后不可回复哦!', {
                time:0,
                btn: ['坚决删除', '不删除'],
                yes:function(){
                    data.iiii = _this.data('iiii');
                    layer.closeAll();
                    layer.load(0, {shade: [0.3, '#000']});
                    $.post('<?php echo U('Ajax/administratorDelete')?>',data,function(result){
                        layer.closeAll();
                        if(result == 1){
                            layer.msg('删除成功', {shift:0});
                            _this.parent().parent().fadeOut(200,function(){
                                $(this).remove();
                            })
                        }else{
                            layer.msg('删除失败', {shift:6});
                        }
                    });
                },
            });
        });
        <?php endif;?>
        <?php if($this->AUTH->check('Admin/Ajax/administratorStatus',session('uid'))):?>
        //禁用
        $('.status').unbind('click');
        $('.status').click(function(){
            var data = {};
            var _this = $(this);
            data.iiii = _this.data('iiii');
            data.iii = _this.data('iii');
            layer.load(0, {shade: [0.3, '#000']});
            $.post('<?php echo U('Ajax/administratorStatus')?>',data,function(result){
                layer.closeAll();
                if(result == 1){
                    if(data.iii == 0){
                        layer.msg('禁用成功', {shift:0});
                        _this
                                .removeClass('btn-warning')
                                .addClass('btn-success')
                                .text('解禁')
                                .data('iii',1);
                    }else{
                        layer.msg('解禁成功', {shift:0});
                        _this
                                .removeClass('btn-success')
                                .addClass('btn-warning')
                                .text('禁用')
                                .data('iii',0);
                    }
                }else{
                    if(data.iii == 0){
                        layer.msg('禁用失败', {shift:6});
                    }else{
                        layer.msg('解禁失败', {shift:6});
                    }
                }
            });
        });
        <?php endif;?>
    });
</script>