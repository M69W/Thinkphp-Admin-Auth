<table class="table table-hover">
    <tr>
        <th>用户组ID</th>
        <th>中文名称</th>
        <th>英文名称</th>
        <th>状态</th>
        <th>规则</th>
    </tr>
    <?php foreach($lists as $v):?>
    <tr>
        <td><?php echo $v['id']?></td>
        <td><?php echo $v['title']?></td>
        <td><?php echo $v['enname']?></td>
        <?php if($v['status']):?>
        <td><span class="green">正常</span></td>
        <?php else:?>
        <td><span class="green">禁用</span></td>
        <?php endif;?>
        <td><?php echo $v['rules']?></td>
        <td>
            <?php if($this->AUTH->check('Admin/Group/update',session('uid'))):?>
                <a href="<?php echo U('Group/update',['iiii'=>$v['id']])?>" class="btn btn-primary btn-xs">修改</a>
            <?php endif;?>
            <?php if($this->AUTH->check('Admin/Ajax/groupDelete',session('uid'))):?>
            <a href="javascript:;" data-iiii="<?php echo $v['id']?>" class="btn btn-danger btn-xs delete">删除</a>
            <?php endif;?>
            <?php if($this->AUTH->check('Admin/Ajax/groupStatus',session('uid'))):?>
                <?php if($v['status']):?>
                <a href="javascript:;" data-iii="0" data-iiii="<?php echo $v['id']?>" class="btn btn-warning btn-xs status">禁用</a>
                <?php else:?>
                <a href="javascript:;" data-iii="1" data-iiii="<?php echo $v['id']?>" class="btn btn-success btn-xs status">解禁</a>
                <?php endif;?>
            <?php endif;?>
        </td>
    </tr>
    <?php endforeach;?>
</table>
<script>
    $(function(){
        <?php if($this->AUTH->check('Admin/Ajax/groupStatus',session('uid'))):?>
        //状态操作
        $('.status').unbind('click');
        $('.status').click(function(){
            layer.load(0);
            var _this = $(this);
            var data = {};
            data.iii = _this.data('iii');
            data.iiii = _this.data('iiii');
            $.post('<?php echo U('Ajax/groupStatus')?>',data,function(result){
                layer.closeAll();
                if(result == 1){
                    if(data.iii == 1){
                        layer.msg('解禁成功', {shift:0});
                        _this
                                .removeClass('btn-success')
                                .addClass('btn-warning')
                                .text('禁用')
                                .data('iii',0)
                                .parent()
                                .prev()
                                .prev()
                                .children()
                                .removeClass('red')
                                .addClass('green')
                                .text('正常');

                    }else{
                        layer.msg('禁用成功', {shift:0});
                        _this
                                .removeClass('btn-warning')
                                .addClass('btn-success')
                                .text('解禁')
                                .data('iii',1)
                                .parent()
                                .prev()
                                .prev()
                                .children()
                                .removeClass('green')
                                .addClass('red')
                                .text('禁用');
                    }
                }else{
                    if(data.iii == 1){
                        layer.msg('解禁失败', {shift:6});
                    }else{
                        layer.msg('禁用失败', {shift:6});
                    }
                }
            });
        });
        <?php endif;?>
        <?php if($this->AUTH->check('Admin/Ajax/groupDelete',session('uid'))):?>
        //删除
        $('.delete').unbind('click');
        $('.delete').click(function(){
            var data = {};
            var _this = $(this);
            layer.msg('确定删除吗?<br />删除之后不可回复哦!', {
                time:0,
                btn: ['坚决删除', '不删除'],
                yes:function(){
                    data.iiii = _this.data('iiii');
                    layer.closeAll();
                    layer.load(0, {shade: [0.3, '#000']});
                    $.post('<?php echo U('Ajax/groupDelete')?>',data,function(result){
                        layer.closeAll();
                        if(result == 1){
                            layer.msg('删除成功', {shift:0});
                            _this.parent().parent().fadeOut(200,function(){
                                $(this).remove();
                            })
                        }else{
                            layer.msg('删除失败', {shift:6});
                        }
                    });
                },
            });
        });
        <?php endif;?>
    });
</script>